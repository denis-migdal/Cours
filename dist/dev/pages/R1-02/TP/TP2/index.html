<!DOCTYPE html>
<html>
    <head>
        <title>TP2 (BDR1)</title>
        <link rel="stylesheet" href="./index.css">
        <script type="module" src="./index.js" defer></script>
    </head>
    <body>
        <header></header>
        <main>

<h1 id="tp2--">TP2 : ???</h1>
<p><em>ğŸ’¡ Ce TP est inspirÃ© de sources en partie inconnues.</em></p>
<h2 id="consignes">Consignes</h2>
<p><tp-consignes></tp-consignes></p>
<p>ğŸ’¡ Dans ce TP, vous reprendrez la base <code>chimiste.sqlite</code> utilisÃ©e au TP prÃ©cÃ©dent.</p>
<p>âš  Vous activerez l&#39;option <code>.changes on</code> afin d&#39;afficher le nombre de lignes modifiÃ©es lors des insertions/modifications/suppressions.</p>
<h2 id="modification-des-entrÃ©es-de-la-table">Modification des entrÃ©es de la table</h2>
<ol>
<li>En une seule requÃªte SQL, insÃ©rez les chimistes suivant dans table <code>chimiste</code> :<pre lang="sql" contenteditable></pre>
<pre style="margin-left: -3em; padding: 0; padding-left: 8px; font-size: 0.85rem; line-height: calc( 1.2 * 0.85rem)">â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚     nom     â”‚ prenom  â”‚ annee_naissance â”‚ annee_mort â”‚ pays_naissance â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 35 â”‚ Markov      â”‚ Andrei  â”‚ 1856            â”‚ 1922       â”‚ Russie         â”‚
â”‚ 34 â”‚ van 't Hoff â”‚ Jacobus â”‚ 1852            â”‚ 1911       â”‚ Pays-Bas       â”‚
â”‚ 33 â”‚ Kekule      â”‚ August  â”‚ 1896            â”‚ 1829       â”‚ Allemagne      â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre></li>
<li>Sachant que 33, 34, et 35 sont les identifiants les plus Ã©levÃ©s, affichez les 2 chimistes que vous venez d&#39;insÃ©rer.<pre lang="sql" contenteditable></pre></li>
<li>Vous remarquerez que August Kekule est mort avant d&#39;Ãªtre nÃ©... En une seule requÃªte, invertissez les annÃ©es de naissance et de mort de l&#39;entrÃ©e d&#39;identifiant <code>33</code>.<pre lang="sql" contenteditable></pre></li>
<li>Pourquoi utiliser le nom/prÃ©nom en place de l&#39;identifiant est dangereux lors de requÃªtes <code>UPDATE</code> et <code>DELETE</code> ?<div contenteditable></div></li>
<li>Il semblerait que Andrei Markov soit un mathÃ©maticien, et non un chimiste, supprimez-le (de la table).<pre lang="sql" contenteditable></pre></li>
</ol>
<h2 id="quelques-prÃ©traitements">Quelques prÃ©traitements</h2>
<p>Comme vu dans le CM, il est possible de prÃ©-traiter les donnÃ©es avant de les manipuler ou de les afficher. Pour rappel, lorsqu&#39;une interface de programmation est utilisÃ©e, il est souvent prÃ©fÃ©rable de faire les prÃ©traitements cÃ´tÃ© langage de programmation que cÃ´tÃ© SQL.</p>
<h3 id="concatÃ©nations">ConcatÃ©nations</h3>
<ol>
<li>Affichez le nom (en majuscules) et prÃ©nom des chercheurs.<pre lang="sql" contenteditable></pre></li>
</ol>
<p>Il est possible de concatÃ©ner des valeurs en utilisant l&#39;opÃ©rateur de concatÃ©nation <code>||</code>. Par exemple <code>a ||Â b</code> retournera <code>ab</code>.</p>
<ol start="2">
<li>Affichez le nom (en majuscules) et le prÃ©nom, sÃ©parÃ©s par un espace, dans une mÃªme colonne nommÃ©e &quot;nom complet&quot;.<pre lang="sql" contenteditable></pre></li>
</ol>
<h3 id="assigner-des-valeurs-Ã -une-catÃ©gorie-conditions">Assigner des valeurs Ã  une catÃ©gorie (conditions)</h3>
<p>Un premier prÃ©-traitement possible est d&#39;assigner Ã  un ensemble de valeur, une catÃ©gorie. Par exemple, associer Ã  chaque chercheur une &quot;Ã©poque&quot;, en :</p>
<ul>
<li>ajoutant 25 Ã  son annÃ©e de naissance ;</li>
<li>effectuant la division entiÃ¨re du rÃ©sultat par 100 ;</li>
<li>re-multipliant le rÃ©sultat par 100.</li>
</ul>
<ol>
<li>Affichez le nom, prÃ©nom, et Ã©poque, des chercheurs.<pre lang="sql" contenteditable></pre></li>
</ol>
<p>Lorsque la catÃ©gorie ne peut Ãªtre calculÃ©e numÃ©riquement, il convient alors d&#39;utiliser des <strong>conditions</strong>. Ces derniÃ¨res s&#39;Ã©crivent sous la forme suivante :</p>
<pre><code class="hljs language-sql"><span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> $COND <span class="hljs-keyword">THEN</span> $VAL_SI_COND_VRAI
               <span class="hljs-keyword">ELSE</span> $VAL_SI_COND_FAUX
<span class="hljs-keyword">END</span>
</code></pre><ol start="2">
<li>Affichez le nom, prÃ©nom, et status (vivant ou mort), des chercheurs.<pre lang="sql" contenteditable></pre></li>
</ol>
<h3 id="formatter-des-dates">Formatter des dates</h3>
<p>Il est frÃ©quent qu&#39;on souhaite extraire des informations d&#39;une date, ou l&#39;afficher diffÃ©remment. Pour cela, on utilise la fonction <code>DATE_FORMAT($FORMAT, $DATE)</code> (<code>STRFTIME</code> pour SQLite). Comme en Python, le format est une chaÃ®ne de caractÃ¨re qui dÃ©fini les Ã©lÃ©ments Ã  afficher :</p>
<ul>
<li><code>%F</code> : la date, Ã©quivalant Ã  <code>%Y-%m-%d</code>.<ul>
<li><code>%Y</code> : l&#39;annÃ©e</li>
<li><code>%m</code> : le mois</li>
<li><code>%d</code> : le jour</li>
</ul>
</li>
<li><code>%T</code> : l&#39;heure, Ã©quivalent Ã  <code>%H:%M:%S</code>.<ul>
<li><code>%H</code> : l&#39;heure</li>
<li><code>%M</code> : les minutes</li>
<li><code>%S</code> : les secondes</li>
</ul>
</li>
</ul>
<ol>
<li>ExÃ©cutez la requÃªte ci-dessous, qu&#39;obtenez-vous ?<div contenteditable></div>

<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> STRFTIME(<span class="hljs-string">&#x27;%d/%m&#x27;</span>, <span class="hljs-type">DATE</span>());
</code></pre></li>
</ol>
<p>Au TP prÃ©cÃ©dent, pour calculer l&#39;Ã¢ge des chimistes encore vivant, nous avions notÃ© l&#39;annÃ©e courante en dur. L&#39;Ã¢ge retournÃ© ne sera ainsi plus correct l&#39;annÃ©e prochaine.</p>
<ol start="2">
<li>Utilisez <code>STRFTIME</code> pour obtenir l&#39;annÃ©e actuelle.<pre lang="sql" contenteditable></pre></li>
<li>Affichez le nom, prÃ©nom, et Ã¢ge des chimistes, cette fois en utilisant <code>STRFTIME</code> pour obtenir l&#39;annÃ©e actuelle.<pre lang="sql" contenteditable></pre></li>
</ol>
<p>ğŸ’¡ Vous constaterez que l&#39;expression permettant de calculer correctement l&#39;Ã¢ge des chimistes est complexe. Vous verrez plus tard des maniÃ¨res permettant d&#39;amÃ©liorer la lisibilitÃ© de telles requÃªtes, et d&#39;Ã©viter la recopie cette expression d&#39;une requÃªte Ã  une autre :</p>
<ul>
<li>via des colonnes gÃ©nÃ©rÃ©es (Cf CM3).</li>
<li>via des vues (cf BDR2).</li>
<li>via des fonctions (cf BDR2?).</li>
</ul>
<h3 id="formatter-des-nombres">Formatter des nombres</h3>
<p>Comme vous le remarquez, toutes les colonnes sont alignÃ©es Ã  gauche, ce qui rend les nombres peu lisibles. Pour corriger cela, on peut formater les nombres via la fonction <code>FORMAT($FORMAT, $NB)</code> (<code>PRINTF</code> pour SQLite &lt; 3.38), qui s&#39;utilise de maniÃ¨re analogue Ã  <code>DATE_FORMAT()</code>.</p>
<ol>
<li>ExÃ©cutez les exemples suivants :<pre><code class="hljs language-sql"> <span class="hljs-keyword">SELECT</span> PRINTF(<span class="hljs-string">&#x27;(%d)&#x27;</span>    , <span class="hljs-number">2.3</span>)  <span class="hljs-keyword">as</span> nb;
 <span class="hljs-keyword">SELECT</span> PRINTF(<span class="hljs-string">&#x27;(%4d)&#x27;</span>   , <span class="hljs-number">2.3</span>)  <span class="hljs-keyword">as</span> nb;
 <span class="hljs-keyword">SELECT</span> PRINTF(<span class="hljs-string">&#x27;(%4.2f)&#x27;</span> , <span class="hljs-number">2.3</span>)  <span class="hljs-keyword">as</span> nb;
 <span class="hljs-keyword">SELECT</span> PRINTF( <span class="hljs-string">&#x27;%4.2f&#x27;</span>  , <span class="hljs-number">2.3</span>)  <span class="hljs-keyword">as</span> nb;
</code></pre></li>
</ol>
<p>Le format suit la structure suivante : <code>%[$len][.$prec]$T</code></p>
<ul>
<li><code>$T</code> est le format d&#39;affichage :<ul>
<li><code>d</code> : entier.</li>
<li><code>x</code> : entier en hexadÃ©cimal.</li>
<li><code>f</code> : rÃ©el.</li>
<li><code>e</code> : rÃ©el en notation exponentielle.</li>
<li><code>s</code> : chaÃ®ne de caractÃ¨res.</li>
</ul>
</li>
<li><code>$len</code> est la longueur minimale (facultatif). Ajoute des espaces en dÃ©but de chaÃ®ne si trop petit.</li>
<li><code>.$prec</code> est le nombre de chiffres aprÃ¨s la virgule Ã  afficher (facultatif).</li>
</ul>
<ol start="2">
<li>Affichez l&#39;Ã¢ge des chimistes avec une prÃ©cision de deux chiffres aprÃ¨s la virgule, et une longueur minimale telle que les Ã¢ges soient correctement alignÃ©s.<pre lang="sql" contenteditable></pre></li>
</ol>
<h2 id="agrÃ©gat-sur-une-colonne">AgrÃ©gat sur une colonne</h2>
<p>Pour rappel, il est possible d&#39;agrÃ©ger plusieurs entrÃ©es au sein d&#39;une mÃªme ligne grÃ¢ce Ã  la clause <code>GROUP BY $COL[,...]</code>. Si une fonction d&#39;agrÃ©gat est utilisÃ©e sans clause <code>GROUP BY</code>, toutes les entrÃ©es seront regroupÃ©es au sein d&#39;une mÃªme ligne.</p>
<ol>
<li>ExÃ©cutez la requÃªte suivante :<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(annee_naissance) <span class="hljs-keyword">as</span> min,
       <span class="hljs-built_in">MAX</span>(annee_naissance) <span class="hljs-keyword">as</span> max
     <span class="hljs-keyword">FROM</span> chimiste;
</code></pre></li>
<li>Affichez le nombre de chimistes dans la table (i.e. compter le nombre d&#39;entrÃ©es).<pre lang="sql" contenteditable></pre></li>
<li>Groupez les entrÃ©es par pays afin d&#39;afficher le pays et son nombre de chimistes (colonne &quot;nb&quot;).<pre lang="sql" contenteditable></pre></li>
<li>Ordonnez le rÃ©sultat par nombre de chimistes dÃ©croissant.<pre lang="sql" contenteditable></pre></li>
<li>Pourquoi ajouter la clause <code>WHERE nb &gt;= 5</code> produira une erreur ?<div contenteditable></div></li>
<li>Ajoutez la clause permettant de n&#39;afficher que les lignes correspondant aux pays avec au moins 5 chimistes.<pre lang="sql" contenteditable></pre></li>
</ol>
<h2 id="fonction-dagrÃ©gat-sur-une-expression">Fonction d&#39;agrÃ©gat sur une expression</h2>
<p>Les fonctions d&#39;agrÃ©gats peuvent prendre en paramÃ¨tre une colonne, mais aussi des expressions. Dans ce cas, il Ã©valuera l&#39;expression pour chaque lignes, avant d&#39;exÃ©cuter la fonction d&#39;agrÃ©gation.</p>
<ol>
<li>En repartant de la requÃªte effectuÃ©e dans la section &quot;Formatter des nombres&quot;, calculez l&#39;Ã¢ge moyen des chimistes dans la base dans une colonne &quot;m(age)&quot;.<pre lang="sql" contenteditable></pre></li>
<li>En ajoutant les clauses une Ã  une, modifiez cette requÃªte pour afficher le pays et l&#39;Ã¢ge moyen des ses chimistes, classÃ©s par ordre croissant d&#39;Ã¢ge moyen.<pre lang="sql" contenteditable></pre></li>
<li>Reprenez la requÃªte prÃ©cÃ©dente, mais n&#39;affichez que les lignes correspondant aux pays ayant un Ã¢ge moyen supÃ©rieur Ã  65 ans.<pre lang="sql" contenteditable></pre></li>
</ol>
</main>
    </body>
</html>